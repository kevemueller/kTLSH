<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from target/generated-site/markdown/index.md
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>kTLSH (parent) &#x2013; kTLSH</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.9.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/kevemueller/kTLSH">
      <img style="position: absolute; top: 0; left: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h2>kTLSH (parent)</h2>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2020-07-03<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0.2-SNAPSHOT</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-down"></span>Project Information</a>
     <ul class="nav nav-list">
      <li><a href="dependency-convergence.html" title="Dependency Convergence"><span class="none"></span>Dependency Convergence</a></li>
      <li><a href="dependency-info.html" title="Dependency Information"><span class="none"></span>Dependency Information</a></li>
      <li><a href="dependency-management.html" title="Dependency Management"><span class="none"></span>Dependency Management</a></li>
      <li><a href="distribution-management.html" title="Distribution Management"><span class="none"></span>Distribution Management</a></li>
      <li class="active"><a href="#"><span class="none"></span>About</a></li>
      <li><a href="issue-management.html" title="Issue Management"><span class="none"></span>Issue Management</a></li>
      <li><a href="licenses.html" title="Licenses"><span class="none"></span>Licenses</a></li>
      <li><a href="plugin-management.html" title="Plugin Management"><span class="none"></span>Plugin Management</a></li>
      <li><a href="plugins.html" title="Plugins"><span class="none"></span>Plugins</a></li>
      <li><a href="team.html" title="Team"><span class="none"></span>Team</a></li>
      <li><a href="scm.html" title="Source Code Management"><span class="none"></span>Source Code Management</a></li>
      <li><a href="summary.html" title="Summary"><span class="none"></span>Summary</a></li>
     </ul></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
   <li class="nav-header">Generated docs</li>
    <li><a href="apidocs/index.html" title="API docs"><span class="none"></span>API docs</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="ktlsh/index.html" title="kTLSH"><span class="none"></span>kTLSH</a></li>
    <li><a href="ktlsh-jmh/index.html" title="kTLSH JMH benchmark"><span class="none"></span>kTLSH JMH benchmark</a></li>
    <li><a href="ktlsh-tool/index.html" title="kTLSH-tool"><span class="none"></span>kTLSH-tool</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>kTLSH</h1>
<p>A fresh look at implementing TLSH in Java.</p>
<p><a class="externalLink" href="http://www.apache.org/licenses/"><img src="https://img.shields.io/github/license/kevemueller/kTLSH.svg?label=License" alt="Apache License, Version 2.0, January 2004" /></a> <a class="externalLink" href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22app.keve.ktlsh%22%20AND%20a%3A%22ktlsh%22"><img src="https://img.shields.io/maven-central/v/app.keve.ktlsh/ktlsh.svg?label=Maven%20Central" alt="Maven Central" /></a> <img src="https://github.com/kevemueller/kTLSH/workflows/Java%20CI%20with%20Maven/badge.svg" alt="Java CI with Maven" /></p><section>
<h2><a name="Purpose"></a>Purpose</h2>
<p>This source implements the <a class="externalLink" href="https://github.com/trendmicro/tlsh">TLSH - Trend Locality Sensitive Hash</a> method in Java language.</p>
<p>While there are already Java implementations of the method, the current one was written with specific design goals in mind. - Specification compliant and unit tested - Java look-and-feel compliant - Performant</p></section><section>
<h2><a name="Usage"></a>Usage</h2>
<p>The module is built with maven. Details on the maven build are at the <a class="externalLink" href="https://ktlsh.keve.app/">kTLSH site</a>. There are also <a class="externalLink" href="https://ktlsh.keve.app/apidocs/">API docs</a>.</p>
<p>Usage follows the pattern used by the other hash methods available in Java.</p>

<div class="source">
<div class="source"><pre class="prettyprint">MessageDigest tlshDigest = MessageDigest.getInstance(&quot;TLSH&quot;);

tlshDigest.update(&quot;Hello world!&quot;.getBytes());
final byte[] hash1 = tlshDigest.digest();
final String encoded1 = TLSHUtil.encoded(hash1);

final byte[] hash2 = tlshDigest.digest(&quot;Goodbye Cruel World&quot;.getBytes());
final String encoded2 = TLSHUtil.encoded(hash2);

final int score = TLSHUtil.score(hash1, hash2, false);
</pre></div></div>

<p>All published TLSH algorithm variants are supported using the following name selector <code>TLSH-(48|128|256)-(1|3)/[4-8]</code>, where <code>48</code>, <code>128</code> or <code>256</code> is the number of buckets, <code>1</code> or <code>3</code>  is the number of checksum bytes and the optional <code>/4</code> to <code>/8</code> suffix is the window size. The window size defaults to 5 bytes and may be omitted. Note that with 48 buckets only 1 checksum byte is specified. That is the full list of algorithms is:</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th> 4B window       </th>
<th> 5B window                                   </th>
<th> 6B window      </th>
<th> 7B window      </th>
<th> 8B window      </th></tr>
</thead><tbody>

<tr class="b">
<td> <code>TLSH-48-1/4</code>   </td>
<td> <code>TLSH-48-1/5</code> aka <code>TLSH-48-1</code>               </td>
<td> <code>TLSH-48-1/6</code>  </td>
<td> <code>TLSH-48-1/7</code>  </td>
<td> <code>TLSH-48-1/8</code>  </td></tr>
<tr class="a">
<td> <code>TLSH-128-1/4</code>  </td>
<td> <code>TLSH-128-1/5</code> aka <code>TLSH-128-1</code> aka <code>TLSH</code>  </td>
<td> <code>TLSH-128-1/6</code> </td>
<td> <code>TLSH-128-1/7</code> </td>
<td> <code>TLSH-128-1/8</code> </td></tr>
<tr class="b">
<td> <code>TLSH-128-3/4</code>  </td>
<td> <code>TLSH-128-3/5</code> aka <code>TLSH-128-3</code>             </td>
<td> <code>TLSH-128-3/6</code> </td>
<td> <code>TLSH-128-3/7</code> </td>
<td> <code>TLSH-128-3/8</code> </td></tr>
<tr class="a">
<td> <code>TLSH-256-1/4</code>  </td>
<td> <code>TLSH-256-1/5</code> aka <code>TLSH-256-1</code>             </td>
<td> <code>TLSH-256-1/6</code> </td>
<td> <code>TLSH-256-1/7</code> </td>
<td> <code>TLSH-256-1/8</code> </td></tr>
<tr class="b">
<td> <code>TLSH-256-3/4</code>  </td>
<td> <code>TLSH-256-3/5</code> aka <code>TLSH-256-3</code>             </td>
<td> <code>TLSH-256-3/6</code> </td>
<td> <code>TLSH-256-3/7</code> </td>
<td> <code>TLSH-256-3/8</code> </td></tr>
</tbody>
</table>
<p>The module only exports the <code>TLSHUtil</code> utility class. It contains the  <code>score</code> utility function that computes the score difference between the provided two hashes as well as formatters for the hexadecimal representation of the TLSH hash number.</p></section><section>
<h2><a name="Compliance_with_the_design_goals"></a>Compliance with the design goals</h2><section>
<h3><a name="Specification_compliant_and_unit_tested"></a>Specification compliant and unit tested</h3>
<p>The source code follows in relevant parts the choices made in the C reference implementation of the algorithm. The hashes obtained and scores calculated are unit tested against the published test data and expected results of the C reference implementation. All tests pass.</p></section><section>
<h3><a name="Java_look-and-feel_compliant"></a>Java look-and-feel compliant</h3>
<p>The module exposes the TLSH algorithm the standard way by defining a MessageDigest service provider. This ensures that the TLSH hash can be computed by the library clients the same way as any other hash would be computed.</p>
<p>The code is following Java source code coding guidelines as published by Sun and checked by checkstyle.</p>
<p>The algorithm is implemented using Java runtime features wherever possible, the code is written to be easy to read and follow.</p></section><section>
<h3><a name="Performant"></a>Performant</h3>
<p>The implementation was tuned with care to perform even on large and very large input streams. For this purpose a separate <a class="externalLink" href="https://openjdk.java.net/projects/code-tools/jmh/">JMH</a> benchmark sub-module was created. Performance optimisation was performed only when it did not conflict with previous design goals. Performance was defined as raw hash bandwidth as well as stress on the Java GC (i.e. no unnecessary creation of objects).</p>
<p>The output of the benchmark harness is as follows</p>

<div class="source">
<div class="source"><pre class="prettyprint">Benchmark                         Mode  Cnt       Score   Error  Units
HashBenchmark.testKLarge16MiB    thrpt    2  114142.230          ops/s
HashBenchmark.testKSmall32KiB    thrpt    2  115001.934          ops/s
HashBenchmark.testTMLarge16MiB   thrpt    2   92331.462          ops/s
HashBenchmark.testTMSmall32KiB   thrpt    2   94514.575          ops/s
HashBenchmark.testMD5Large16MiB  thrpt    2  507247.038          ops/s
HashBenchmark.testMD5Small32KiB  thrpt    2  497034.176          ops/s
</pre></div></div>

<p>The results show that the implementation is approximately 24% faster on large datasets and approximately. 22% faster on small datasets compared to the reference Java port. Preliminary comparison on large datasets of the C++ implementation show that the C++ implementation is comparable in speed to the reference Java implementation, i.e. slower than this Java implementation.</p>
<p>As a comparison the performance of the MD5 hash on the same datasets is also obtained.</p>
<p>All numbers are scaled to KiB/s hashing bandwidth, i.e. the implementation hashes 112MiB/s on the developers MacBook Pro.</p>
<p>Further increase in performance is currently being investigated.</p></section></section><section>
<h2><a name="Other_implementations"></a>Other implementations</h2>
<p>The reference implementation of the algorithm including a reference port to Java language can be found in the <a class="externalLink" href="https://github.com/trendmicro/tlsh">authors&#x2019; repository</a>.</p>
<p>Another implementation can be found under <a class="externalLink" href="https://github.com/idealista/tlsh">https://github.com/idealista/tlsh</a>.</p></section><section>
<h2><a name="Notable_differences"></a>Notable differences</h2><section>
<h3><a name="Match_with_the_C.2B.2B_reference_implementation"></a>Match with the C++ reference implementation</h3>
<p>This implementation follows the original C++ reference implementation and not the Java reference implementation.</p></section><section>
<h3><a name="Arbitrary_input_size"></a>Arbitrary input size</h3>
<p>This implementation will compute hashes for all input sizes between 0 and Long.MAX_VALUE, i.e. 8EiB. The C++ reference implementation will only produce a hash if a minimum of 50 bytes and a minimum level of entropy was fed into the digester. Also the C++ implementation has an upper bound of 2GiB.</p></section></section><section>
<h2><a name="Feedback"></a>Feedback</h2>
<p>The author is happy for any feedback and suggestion.</p></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2020
</p>
        </div>
      </div>
    </footer>
  </body>
</html>